<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammatica Cinese - Lezioni Dettagliate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        .chinese-text {
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .lesson-card {
            transition: all 0.3s ease;
        }
        
        .lesson-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .example-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid #0ea5e9;
        }
        
        .note-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
        }
        
        .exercise-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left: 4px solid #22c55e;
        }
        
        .progress-circle {
            transform: rotate(-90deg);
        }
        
        .progress-circle-fill {
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 10;
        }
        
        .grammar-highlight {
            background: linear-gradient(120deg, #fbbf24 0%, #f59e0b 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .pinyin-text {
            color: #3b82f6;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-['Inter']">
    
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-xl">Êñá</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">Grammatica Cinese</h1>
                        <p class="text-sm text-gray-600">Lezioni dettagliate e strutturate</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Lezioni completate: <span id="completed-lessons" class="font-bold text-blue-600">0</span></p>
                        <p class="text-xs text-gray-500">Progresso: <span id="progress-percentage" class="font-bold">0%</span></p>
                    </div>
                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white">
                        üìñ
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- Main Menu -->
        <div id="main-menu" class="mb-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Lezioni di Grammatica</h2>
                <p class="text-gray-600">Impara la grammatica cinese con lezioni dettagliate e strutturate</p>
            </div>

            <!-- Level Tabs -->
            <div class="flex justify-center mb-8">
                <div class="bg-white rounded-lg p-1 shadow-sm border border-gray-200">
                    <button class="level-tab px-6 py-2 rounded-md font-medium transition-colors bg-blue-500 text-white" data-level="basic">
                        Base
                    </button>
                    <button class="level-tab px-6 py-2 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-900" data-level="intermediate">
                        Intermedio
                    </button>
                    <button class="level-tab px-6 py-2 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-900" data-level="advanced">
                        Avanzato
                    </button>
                </div>
            </div>

            <!-- Lessons Grid -->
            <div id="lessons-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Lessons will be dynamically inserted here -->
            </div>
        </div>

        <!-- Lesson Content -->
        <div id="lesson-content" class="hidden">
            <!-- Back Button -->
            <button id="back-btn" class="mb-6 flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors">
                <span>‚Üê</span>
                <span>Torna alle Lezioni</span>
            </button>

            <!-- Lesson Header -->
            <div id="lesson-header" class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 mb-6">
                <!-- Header content will be inserted here -->
            </div>

            <!-- Lesson Body -->
            <div id="lesson-body" class="space-y-6">
                <!-- Lesson content will be inserted here -->
            </div>

            <!-- Lesson Navigation -->
            <div id="lesson-nav" class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                <button id="prev-lesson" class="flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50">
                    <span>‚Üê</span>
                    <span>Precedente</span>
                </button>
                <button id="mark-complete" class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                    ‚úì Completa Lezione
                </button>
                <button id="next-lesson" class="flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50">
                    <span>Successiva</span>
                    <span>‚Üí</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div id="exercise-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">Esercizio</h3>
                    <button id="close-exercise" class="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                </div>
                
                <div id="exercise-content" class="space-y-6">
                    <!-- Exercise content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentLevel = 'basic';
        let currentLessonId = null;
        let completedLessons = new Set(JSON.parse(localStorage.getItem('completedLessons') || '[]'));
        let currentExercise = null;

        // Grammar lessons database
        const grammarLessons = {
            basic: [
                {
                    id: 'word-order',
                    title: 'Ordine delle Parole',
                    description: 'La struttura base delle frasi cinesi',
                    duration: '15 min',
                    difficulty: 1,
                    content: {
                        introduction: 'Il cinese segue un ordine delle parole relativamente fisso: Soggetto + Verbo + Oggetto (SVO), simile all\'italiano.',
                        sections: [
                            {
                                title: 'Struttura Base: SVO',
                                content: 'La struttura pi√π comune √® Soggetto + Verbo + Oggetto.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÂêÉËãπÊûú„ÄÇ',
                                        pinyin: 'W«í chƒ´ p√≠nggu«í.',
                                        italian: 'Io mangio una mela.',
                                        breakdown: ['Êàë (w«í) = io', 'ÂêÉ (chƒ´) = mangiare', 'ËãπÊûú (p√≠nggu«í) = mela']
                                    },
                                    {
                                        chinese: '‰ªñÂ≠¶‰∏≠Êñá„ÄÇ',
                                        pinyin: 'TƒÅ xu√© zh≈çngw√©n.',
                                        italian: 'Lui studia cinese.',
                                        breakdown: ['‰ªñ (tƒÅ) = lui', 'Â≠¶ (xu√©) = studiare', '‰∏≠Êñá (zh≈çngw√©n) = cinese']
                                    }
                                ]
                            },
                            {
                                title: 'Complementi di Tempo',
                                content: 'I complementi di tempo vanno generalmente prima del verbo.',
                                examples: [
                                    {
                                        chinese: 'Êàë‰ªäÂ§©ÂêÉËãπÊûú„ÄÇ',
                                        pinyin: 'W«í jƒ´ntiƒÅn chƒ´ p√≠nggu«í.',
                                        italian: 'Oggi io mangio una mela.',
                                        breakdown: ['‰ªäÂ§© (jƒ´ntiƒÅn) = oggi', 'va prima del verbo']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'A differenza dell\'italiano, gli avverbi di tempo vanno prima del verbo',
                            'L\'ordine delle parole √® pi√π rigido rispetto all\'italiano'
                        ],
                        exercises: [
                            {
                                type: 'order',
                                question: 'Riordina le parole per formare una frase corretta:',
                                words: ['Êàë', '‰π¶', 'ËØª'],
                                correct: 'ÊàëËØª‰π¶„ÄÇ',
                                translation: 'Io leggo un libro.'
                            }
                        ]
                    }
                },
                {
                    id: 'particles-de',
                    title: 'La Particella ÁöÑ (de)',
                    description: 'Uso della particella possessiva e attributiva',
                    duration: '20 min',
                    difficulty: 2,
                    content: {
                        introduction: 'La particella ÁöÑ (de) √® una delle pi√π importanti in cinese. Ha principalmente due funzioni: possessiva e attributiva.',
                        sections: [
                            {
                                title: 'Funzione Possessiva',
                                content: 'ÁöÑ indica possesso o appartenenza, simile a "di" in italiano.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÁöÑ‰π¶',
                                        pinyin: 'w«í de sh≈´',
                                        italian: 'il mio libro',
                                        breakdown: ['Êàë (w«í) = io', 'ÁöÑ (de) = particella possessiva', '‰π¶ (sh≈´) = libro']
                                    },
                                    {
                                        chinese: 'ËÄÅÂ∏àÁöÑËΩ¶',
                                        pinyin: 'l«éoshƒ´ de chƒì',
                                        italian: 'la macchina del professore',
                                        breakdown: ['ËÄÅÂ∏à (l«éoshƒ´) = professore', 'ËΩ¶ (chƒì) = macchina']
                                    }
                                ]
                            },
                            {
                                title: 'Funzione Attributiva',
                                content: 'ÁöÑ collega aggettivi ai sostantivi che modificano.',
                                examples: [
                                    {
                                        chinese: 'Á∫¢Ëâ≤ÁöÑËãπÊûú',
                                        pinyin: 'h√≥ngs√® de p√≠nggu«í',
                                        italian: 'mela rossa',
                                        breakdown: ['Á∫¢Ëâ≤ (h√≥ngs√®) = rosso', 'ËãπÊûú (p√≠nggu«í) = mela']
                                    }
                                ]
                            },
                            {
                                title: 'Omissione di ÁöÑ',
                                content: 'Con relazioni familiari strette, ÁöÑ pu√≤ essere omesso.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÂ¶àÂ¶à (non ÊàëÁöÑÂ¶àÂ¶à)',
                                        pinyin: 'w«í mƒÅma',
                                        italian: 'mia madre',
                                        breakdown: ['Con famiglia stretta, ÁöÑ si omette spesso']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Con aggettivi monosillabici, ÁöÑ spesso si omette: Â•Ω‰∫∫ (brava persona)',
                            'L\'ordine √® sempre: possessore + ÁöÑ + posseduto'
                        ],
                        exercises: [
                            {
                                type: 'choice',
                                question: 'Quale frase √® corretta?',
                                options: ['ÊàëÁöÑÁöÑ‰π¶', 'ÊàëÁöÑ‰π¶', 'Êàë‰π¶ÁöÑ', 'ÁöÑÊàë‰π¶'],
                                correct: 1,
                                explanation: 'ÊàëÁöÑ‰π¶ √® corretto: possessore + ÁöÑ + posseduto'
                            }
                        ]
                    }
                },
                {
                    id: 'questions-ma',
                    title: 'Domande con Âêó (ma)',
                    description: 'Formare domande s√¨/no con la particella Âêó',
                    duration: '15 min',
                    difficulty: 1,
                    content: {
                        introduction: 'La particella Âêó (ma) √® il modo pi√π semplice per trasformare un\'affermazione in una domanda s√¨/no.',
                        sections: [
                            {
                                title: 'Formazione Base',
                                content: 'Aggiungi Âêó alla fine di una frase affermativa per formare una domanda.',
                                examples: [
                                    {
                                        chinese: '‰Ω†ÊòØÂ≠¶Áîü„ÄÇ‚Üí ‰Ω†ÊòØÂ≠¶ÁîüÂêóÔºü',
                                        pinyin: 'N«ê sh√¨ xu√©sheng. ‚Üí N«ê sh√¨ xu√©sheng ma?',
                                        italian: 'Tu sei studente. ‚Üí Sei studente?',
                                        breakdown: ['Aggiungi semplicemente Âêó alla fine']
                                    },
                                    {
                                        chinese: '‰ªñÂñúÊ¨¢ÂíñÂï°ÂêóÔºü',
                                        pinyin: 'TƒÅ x«êhuan kƒÅfƒìi ma?',
                                        italian: 'Gli piace il caff√®?',
                                        breakdown: ['‰ªñ (tƒÅ) = lui', 'ÂñúÊ¨¢ (x«êhuan) = piacere', 'ÂíñÂï° (kƒÅfƒìi) = caff√®']
                                    }
                                ]
                            },
                            {
                                title: 'Risposte',
                                content: 'Le risposte ripetono il verbo principale per "s√¨" o lo negano per "no".',
                                examples: [
                                    {
                                        chinese: 'Q: ‰Ω†ÊòØÂ≠¶ÁîüÂêóÔºüA: ÊòØÁöÑ„ÄÇ/ ‰∏çÊòØ„ÄÇ',
                                        pinyin: 'Q: N«ê sh√¨ xu√©sheng ma? A: Sh√¨ de. / B√π sh√¨.',
                                        italian: 'D: Sei studente? R: S√¨. / No.',
                                        breakdown: ['ÊòØÁöÑ (sh√¨ de) = s√¨', '‰∏çÊòØ (b√π sh√¨) = no']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Non usare Âêó con altre parole interrogative (‰ªÄ‰πà, Âì™Èáå, etc.)',
                            'Il tono di Âêó √® neutro (ma senza tono)'
                        ],
                        exercises: [
                            {
                                type: 'transform',
                                question: 'Trasforma in domanda: ‰Ω†ÂñúÊ¨¢Èü≥‰πê„ÄÇ',
                                correct: '‰Ω†ÂñúÊ¨¢Èü≥‰πêÂêóÔºü',
                                explanation: 'Aggiungi Âêó alla fine della frase affermativa'
                            }
                        ]
                    }
                }
            ],
            intermediate: [
                {
                    id: 'aspect-le',
                    title: 'Aspetto Perfettivo ‰∫Ü (le)',
                    description: 'Uso di ‰∫Ü per indicare azioni completate',
                    duration: '25 min',
                    difficulty: 3,
                    content: {
                        introduction: '‰∫Ü (le) non indica tempo passato, ma aspetto perfettivo - azioni completate o cambio di stato.',
                        sections: [
                            {
                                title: '‰∫Ü Verbale',
                                content: '‰∫Ü subito dopo il verbo indica che l\'azione √® stata completata.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÂêÉ‰∫ÜËãπÊûú„ÄÇ',
                                        pinyin: 'W«í chƒ´ le p√≠nggu«í.',
                                        italian: 'Ho mangiato una mela.',
                                        breakdown: ['ÂêÉ‰∫Ü = azione di mangiare completata']
                                    },
                                    {
                                        chinese: '‰ªñ‰π∞‰∫Ü‰∏âÊú¨‰π¶„ÄÇ',
                                        pinyin: 'TƒÅ m«éi le sƒÅn bƒõn sh≈´.',
                                        italian: 'Ha comprato tre libri.',
                                        breakdown: ['‰π∞‰∫Ü = azione di comprare completata', '‰∏âÊú¨ = tre (classificatore per libri)']
                                    }
                                ]
                            },
                            {
                                title: '‰∫Ü Frasale',
                                content: '‰∫Ü alla fine della frase indica un nuovo stato o situazione.',
                                examples: [
                                    {
                                        chinese: '‰∏ãÈõ®‰∫Ü„ÄÇ',
                                        pinyin: 'Xi√† y«î le.',
                                        italian: 'Sta piovendo. (√® iniziato a piovere)',
                                        breakdown: ['Cambio di stato: ora piove']
                                    },
                                    {
                                        chinese: 'ÊàëÈ•ø‰∫Ü„ÄÇ',
                                        pinyin: 'W«í √® le.',
                                        italian: 'Ho fame. (sono diventato affamato)',
                                        breakdown: ['Nuovo stato: ora ho fame']
                                    }
                                ]
                            },
                            {
                                title: 'Doppio ‰∫Ü',
                                content: 'Quando si usano entrambi i ‰∫Ü nella stessa frase.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÂêÉ‰∫ÜÈ•≠‰∫Ü„ÄÇ',
                                        pinyin: 'W«í chƒ´ le f√†n le.',
                                        italian: 'Ho mangiato (e la situazione √® cambiata).',
                                        breakdown: ['Primo ‰∫Ü: azione completata', 'Secondo ‰∫Ü: nuovo stato']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            '‰∫Ü non equivale al passato prossimo italiano',
                            'Pu√≤ essere usato per eventi futuri se sono certi',
                            'Non usare ‰∫Ü per azioni abituali nel passato'
                        ],
                        exercises: [
                            {
                                type: 'choice',
                                question: 'Quale frase indica che l\'azione √® completata?',
                                options: ['ÊàëÂêÉËãπÊûú', 'ÊàëÂêÉ‰∫ÜËãπÊûú', 'ÊàëË¶ÅÂêÉËãπÊûú', 'ÊàëÂú®ÂêÉËãπÊûú'],
                                correct: 1,
                                explanation: 'ÂêÉ‰∫Ü indica che l\'azione di mangiare √® stata completata'
                            }
                        ]
                    }
                },
                {
                    id: 'classifiers',
                    title: 'Classificatori (Parole di Misura)',
                    description: 'Uso dei classificatori con numeri e sostantivi',
                    duration: '30 min',
                    difficulty: 4,
                    content: {
                        introduction: 'I classificatori sono parole che vanno tra numeri/dimostrativi e sostantivi. Ogni sostantivo ha classificatori specifici.',
                        sections: [
                            {
                                title: 'Classificatori Comuni',
                                content: 'I classificatori pi√π frequenti e i loro usi.',
                                examples: [
                                    {
                                        chinese: '‰∏Ä‰∏™‰∫∫ (y√≠ g√® r√©n)',
                                        pinyin: 'y√≠ g√® r√©n',
                                        italian: 'una persona',
                                        breakdown: ['‰∏™ (g√®) = classificatore generale per persone e oggetti']
                                    },
                                    {
                                        chinese: '‰∏âÊú¨‰π¶ (sƒÅn bƒõn sh≈´)',
                                        pinyin: 'sƒÅn bƒõn sh≈´',
                                        italian: 'tre libri',
                                        breakdown: ['Êú¨ (bƒõn) = classificatore per libri, riviste']
                                    },
                                    {
                                        chinese: '‰∏§Âè™Áå´ (li«éng zhƒ´ mƒÅo)',
                                        pinyin: 'li«éng zhƒ´ mƒÅo',
                                        italian: 'due gatti',
                                        breakdown: ['Âè™ (zhƒ´) = classificatore per animali']
                                    }
                                ]
                            },
                            {
                                title: 'Classificatori Specifici',
                                content: 'Classificatori per categorie specifiche di oggetti.',
                                examples: [
                                    {
                                        chinese: '‰∏ÄÂº†Ê°åÂ≠ê (y√¨ zhƒÅng zhu≈çzi)',
                                        pinyin: 'y√¨ zhƒÅng zhu≈çzi',
                                        italian: 'un tavolo',
                                        breakdown: ['Âº† (zhƒÅng) = per oggetti piatti: tavoli, carte, letti']
                                    },
                                    {
                                        chinese: '‰∫îËæÜËΩ¶ (w«î li√†ng chƒì)',
                                        pinyin: 'w«î li√†ng chƒì',
                                        italian: 'cinque macchine',
                                        breakdown: ['ËæÜ (li√†ng) = per veicoli']
                                    }
                                ]
                            },
                            {
                                title: 'Con Dimostrativi',
                                content: 'I classificatori si usano anche con "questo" e "quello".',
                                examples: [
                                    {
                                        chinese: 'Ëøô‰∏™ËãπÊûú (zh√®ge p√≠nggu«í)',
                                        pinyin: 'zh√®ge p√≠nggu«í',
                                        italian: 'questa mela',
                                        breakdown: ['Ëøô (zh√®) + ‰∏™ (g√®) = questo']
                                    },
                                    {
                                        chinese: 'ÈÇ£Êú¨‰π¶ (n√† bƒõn sh≈´)',
                                        pinyin: 'n√† bƒõn sh≈´',
                                        italian: 'quel libro',
                                        breakdown: ['ÈÇ£ (n√†) + Êú¨ (bƒõn) = quel']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            '‰∏™ (g√®) √® il classificatore pi√π comune e pu√≤ essere usato quando non si conosce quello specifico',
                            'Ogni sostantivo ha un classificatore "corretto", ma ‰∏™ √® spesso accettabile',
                            'I classificatori sono obbligatori con numeri e dimostrativi'
                        ],
                        exercises: [
                            {
                                type: 'fill',
                                question: 'Completa: ‰∏§___Áãó (due cani)',
                                options: ['‰∏™', 'Êú¨', 'Âè™', 'Âº†'],
                                correct: 2,
                                explanation: 'Âè™ √® il classificatore corretto per gli animali'
                            }
                        ]
                    }
                },
                {
                    id: 'comparison',
                    title: 'Costruzioni Comparative',
                    description: 'Confronti con ÊØî, Ê≤°Êúâ e altri pattern',
                    duration: '25 min',
                    difficulty: 3,
                    content: {
                        introduction: 'Il cinese ha diversi modi per esprimere confronti e comparazioni tra oggetti, persone o situazioni.',
                        sections: [
                            {
                                title: 'Comparativo con ÊØî (b«ê)',
                                content: 'Struttura: A + ÊØî + B + aggettivo per dire "A √® pi√π... di B".',
                                examples: [
                                    {
                                        chinese: 'ÊàëÊØî‰ªñÈ´ò„ÄÇ',
                                        pinyin: 'W«í b«ê tƒÅ gƒÅo.',
                                        italian: 'Io sono pi√π alto di lui.',
                                        breakdown: ['Êàë (w«í) = io', 'ÊØî (b«ê) = pi√π di', '‰ªñ (tƒÅ) = lui', 'È´ò (gƒÅo) = alto']
                                    },
                                    {
                                        chinese: 'ËøôÊú¨‰π¶ÊØîÈÇ£Êú¨‰π¶ÊúâË∂£„ÄÇ',
                                        pinyin: 'Zh√® bƒõn sh≈´ b«ê n√† bƒõn sh≈´ y«íuq√π.',
                                        italian: 'Questo libro √® pi√π interessante di quello.',
                                        breakdown: ['ÊúâË∂£ (y«íuq√π) = interessante']
                                    }
                                ]
                            },
                            {
                                title: 'Comparativo Negativo con Ê≤°Êúâ',
                                content: 'Struttura: A + Ê≤°Êúâ + B + aggettivo per dire "A non √® tanto... quanto B".',
                                examples: [
                                    {
                                        chinese: 'ÊàëÊ≤°Êúâ‰ªñÈ´ò„ÄÇ',
                                        pinyin: 'W«í m√©iy«íu tƒÅ gƒÅo.',
                                        italian: 'Io non sono alto quanto lui.',
                                        breakdown: ['Ê≤°Êúâ (m√©iy«íu) = non tanto quanto']
                                    }
                                ]
                            },
                            {
                                title: 'Superlativo con ÊúÄ (zu√¨)',
                                content: 'ÊúÄ + aggettivo = il pi√π...',
                                examples: [
                                    {
                                        chinese: '‰ªñÊòØÊúÄÈ´òÁöÑÂ≠¶Áîü„ÄÇ',
                                        pinyin: 'TƒÅ sh√¨ zu√¨ gƒÅo de xu√©sheng.',
                                        italian: 'Lui √® lo studente pi√π alto.',
                                        breakdown: ['ÊúÄ (zu√¨) = il pi√π', 'ÁöÑ collega aggettivo e sostantivo']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Non usare Êõ¥ (g√®ng) con ÊØî nella stessa frase',
                            'Ê≤°Êúâ √® pi√π morbido di ‰∏çÊØî per negare confronti',
                            'Con ÊúÄ, spesso si aggiunge ÁöÑ prima del sostantivo'
                        ],
                        exercises: [
                            {
                                type: 'translate',
                                question: 'Traduci: "Il t√® √® pi√π buono del caff√®"',
                                correct: 'Ëå∂ÊØîÂíñÂï°Â•Ω„ÄÇ',
                                explanation: 'Struttura: Ëå∂ (t√®) + ÊØî + ÂíñÂï° (caff√®) + Â•Ω (buono)'
                            }
                        ]
                    }
                }
            ],
            advanced: [
                {
                    id: 'resultative',
                    title: 'Complementi Risultativi',
                    description: 'Verbi composti che indicano il risultato di un\'azione',
                    duration: '35 min',
                    difficulty: 5,
                    content: {
                        introduction: 'I complementi risultativi indicano il risultato o l\'esito di un\'azione. Si formano combinando un verbo d\'azione con un verbo/aggettivo risultativo.',
                        sections: [
                            {
                                title: 'Struttura Base',
                                content: 'Verbo d\'azione + Complemento risultativo',
                                examples: [
                                    {
                                        chinese: 'ÊàëÁúãÊáÇ‰∫ÜËøôÊú¨‰π¶„ÄÇ',
                                        pinyin: 'W«í k√†n d«íng le zh√® bƒõn sh≈´.',
                                        italian: 'Ho capito questo libro (leggendolo).',
                                        breakdown: ['Áúã (k√†n) = guardare/leggere', 'ÊáÇ (d«íng) = capire', 'ÁúãÊáÇ = capire leggendo']
                                    },
                                    {
                                        chinese: '‰ªñË∑ëÁ¥Ø‰∫Ü„ÄÇ',
                                        pinyin: 'TƒÅ p«éo l√®i le.',
                                        italian: 'Si √® stancato correndo.',
                                        breakdown: ['Ë∑ë (p«éo) = correre', 'Á¥Ø (l√®i) = stanco', 'Ë∑ëÁ¥Ø = stancarsi correndo']
                                    }
                                ]
                            },
                            {
                                title: 'Complementi Comuni',
                                content: 'I complementi risultativi pi√π frequenti.',
                                examples: [
                                    {
                                        chinese: 'Âê¨Ê∏ÖÊ•ö (tƒ´ng qƒ´ngchu)',
                                        pinyin: 'tƒ´ng qƒ´ngchu',
                                        italian: 'sentire chiaramente',
                                        breakdown: ['Âê¨ (tƒ´ng) = sentire', 'Ê∏ÖÊ•ö (qƒ´ngchu) = chiaro']
                                    },
                                    {
                                        chinese: 'ÂÅöÂÆå (zu√≤ w√°n)',
                                        pinyin: 'zu√≤ w√°n',
                                        italian: 'finire di fare',
                                        breakdown: ['ÂÅö (zu√≤) = fare', 'ÂÆå (w√°n) = finito']
                                    },
                                    {
                                        chinese: 'ÊâæÂà∞ (zh«éo d√†o)',
                                        pinyin: 'zh«éo d√†o',
                                        italian: 'trovare (con successo)',
                                        breakdown: ['Êâæ (zh«éo) = cercare', 'Âà∞ (d√†o) = arrivare/ottenere']
                                    }
                                ]
                            },
                            {
                                title: 'Forma Potenziale',
                                content: 'Aggiungere Âæó/‰∏ç per indicare possibilit√†.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÁúãÂæóÊáÇ‰∏≠Êñá„ÄÇ',
                                        pinyin: 'W«í k√†n de d«íng zh≈çngw√©n.',
                                        italian: 'Riesco a capire il cinese (leggendo).',
                                        breakdown: ['Âæó (de) = indica possibilit√† positiva']
                                    },
                                    {
                                        chinese: 'ÊàëÂê¨‰∏çÊ∏ÖÊ•ö„ÄÇ',
                                        pinyin: 'W«í tƒ´ng bu qƒ´ngchu.',
                                        italian: 'Non riesco a sentire chiaramente.',
                                        breakdown: ['‰∏ç (bu) = indica impossibilit√†']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Il complemento risultativo √® inseparabile dal verbo principale',
                            'Con oggetti, la struttura diventa: Soggetto + Verbo + Oggetto + Verbo + Complemento',
                            'Molto comune nel cinese parlato per esprimere precisione'
                        ],
                        exercises: [
                            {
                                type: 'choice',
                                question: 'Come si dice "Non riesco a finire di mangiare"?',
                                options: ['ÊàëÂêÉ‰∏çÂÆå', 'Êàë‰∏çÂêÉÂÆå', 'ÊàëÂêÉÂÆå‰∏ç', 'Êàë‰∏çÂÆåÂêÉ'],
                                correct: 0,
                                explanation: 'ÂêÉ‰∏çÂÆå: ÂêÉ (mangiare) + ‰∏ç (non riesco) + ÂÆå (finire)'
                            }
                        ]
                    }
                },
                {
                    id: 'passive-bei',
                    title: 'Forma Passiva con Ë¢´ (b√®i)',
                    description: 'Costruzione della forma passiva in cinese',
                    duration: '30 min',
                    difficulty: 4,
                    content: {
                        introduction: 'La forma passiva con Ë¢´ (b√®i) si usa quando il soggetto subisce l\'azione invece di compierla. √à meno comune che in italiano.',
                        sections: [
                            {
                                title: 'Struttura Base',
                                content: 'Soggetto + Ë¢´ + Agente + Verbo + (Oggetto)',
                                examples: [
                                    {
                                        chinese: '‰π¶Ë¢´ÊàëÁúãÂÆå‰∫Ü„ÄÇ',
                                        pinyin: 'Sh≈´ b√®i w«í k√†n w√°n le.',
                                        italian: 'Il libro √® stato finito di leggere da me.',
                                        breakdown: ['‰π¶ (sh≈´) = libro (soggetto passivo)', 'Ë¢´ (b√®i) = da', 'Êàë (w«í) = io (agente)']
                                    },
                                    {
                                        chinese: 'Á™óÊà∑Ë¢´È£éÂêπÂºÄ‰∫Ü„ÄÇ',
                                        pinyin: 'ChuƒÅnghu b√®i fƒìng chuƒ´ kƒÅi le.',
                                        italian: 'La finestra √® stata aperta dal vento.',
                                        breakdown: ['Á™óÊà∑ (chuƒÅnghu) = finestra', 'È£é (fƒìng) = vento', 'ÂêπÂºÄ (chuƒ´ kƒÅi) = aprire soffiando']
                                    }
                                ]
                            },
                            {
                                title: 'Passivo Senza Agente',
                                content: 'Quando l\'agente √® sconosciuto o non importante.',
                                examples: [
                                    {
                                        chinese: 'ÊàëÁöÑËá™Ë°åËΩ¶Ë¢´ÂÅ∑‰∫Ü„ÄÇ',
                                        pinyin: 'W«í de z√¨x√≠ngchƒì b√®i t≈çu le.',
                                        italian: 'La mia bicicletta √® stata rubata.',
                                        breakdown: ['Ëá™Ë°åËΩ¶ (z√¨x√≠ngchƒì) = bicicletta', 'ÂÅ∑ (t≈çu) = rubare']
                                    }
                                ]
                            },
                            {
                                title: 'Connotazione Negativa',
                                content: 'Il passivo con Ë¢´ spesso implica qualcosa di spiacevole.',
                                examples: [
                                    {
                                        chinese: '‰ªñË¢´ËÄÅÂ∏àÊâπËØÑ‰∫Ü„ÄÇ',
                                        pinyin: 'TƒÅ b√®i l«éoshƒ´ pƒ´p√≠ng le.',
                                        italian: '√à stato criticato dal professore.',
                                        breakdown: ['ÊâπËØÑ (pƒ´p√≠ng) = criticare (connotazione negativa)']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Il passivo √® meno usato in cinese che in italiano',
                            'Spesso implica eventi negativi o indesiderati',
                            'Per eventi neutri/positivi, si preferisce la forma attiva'
                        ],
                        exercises: [
                            {
                                type: 'transform',
                                question: 'Trasforma in passivo: ËÄÅÂ∏àË°®Êâ¨‰∫ÜÂ≠¶Áîü„ÄÇ',
                                correct: 'Â≠¶ÁîüË¢´ËÄÅÂ∏àË°®Êâ¨‰∫Ü„ÄÇ',
                                explanation: 'Soggetto originale (Â≠¶Áîü) + Ë¢´ + agente (ËÄÅÂ∏à) + verbo'
                            }
                        ]
                    }
                },
                {
                    id: 'conditional',
                    title: 'Frasi Condizionali',
                    description: 'Esprimere condizioni con Â¶ÇÊûú, Ë¶ÅÊòØ, ÁöÑËØù',
                    duration: '25 min',
                    difficulty: 4,
                    content: {
                        introduction: 'Le frasi condizionali esprimono situazioni ipotetiche. Il cinese ha diverse strutture per esprimere condizioni.',
                        sections: [
                            {
                                title: 'Condizionale con Â¶ÇÊûú (r√∫gu«í)',
                                content: 'Â¶ÇÊûú + condizione + Â∞± + risultato (Se... allora...)',
                                examples: [
                                    {
                                        chinese: 'Â¶ÇÊûúÊòéÂ§©‰∏ãÈõ®ÔºåÊàëÂ∞±‰∏çÂéªÂÖ¨Âõ≠„ÄÇ',
                                        pinyin: 'R√∫gu«í m√≠ngtiƒÅn xi√† y«î, w«í ji√π b√π q√π g≈çngyu√°n.',
                                        italian: 'Se domani piove, allora non andr√≤ al parco.',
                                        breakdown: ['Â¶ÇÊûú (r√∫gu«í) = se', 'Â∞± (ji√π) = allora', '‰∏ãÈõ® (xi√† y«î) = piovere']
                                    }
                                ]
                            },
                            {
                                title: 'Condizionale con Ë¶ÅÊòØ (y√†oshi)',
                                content: 'Ë¶ÅÊòØ √® pi√π colloquiale di Â¶ÇÊûú.',
                                examples: [
                                    {
                                        chinese: 'Ë¶ÅÊòØ‰Ω†ÊúâÊó∂Èó¥ÔºåÊàë‰ª¨‰∏ÄËµ∑ÂêÉÈ•≠Âêß„ÄÇ',
                                        pinyin: 'Y√†oshi n«ê y«íu sh√≠jiƒÅn, w«ímen y√¨q«ê chƒ´ f√†n ba.',
                                        italian: 'Se hai tempo, mangiamo insieme.',
                                        breakdown: ['Ë¶ÅÊòØ (y√†oshi) = se (colloquiale)', '‰∏ÄËµ∑ (y√¨q«ê) = insieme']
                                    }
                                ]
                            },
                            {
                                title: 'Condizionale con ÁöÑËØù (de hu√†)',
                                content: 'ÁöÑËØù va alla fine della clausola condizionale.',
                                examples: [
                                    {
                                        chinese: '‰Ω†‰∏çÊù•ÁöÑËØùÔºåÊàë‰ª¨Â∞±ÂºÄÂßãÂêß„ÄÇ',
                                        pinyin: 'N«ê b√π l√°i de hu√†, w«ímen ji√π kƒÅish«ê ba.',
                                        italian: 'Se non vieni, allora iniziamo.',
                                        breakdown: ['ÁöÑËØù (de hu√†) = se (alla fine della condizione)', 'ÂºÄÂßã (kƒÅish«ê) = iniziare']
                                    }
                                ]
                            }
                        ],
                        notes: [
                            'Â∞± nella clausola principale √® opzionale ma comune',
                            'Ë¶ÅÊòØ √® pi√π informale di Â¶ÇÊûú',
                            'ÁöÑËØù pu√≤ essere combinato con Â¶ÇÊûú: Â¶ÇÊûú...ÁöÑËØù'
                        ],
                        exercises: [
                            {
                                type: 'complete',
                                question: 'Completa: ___Â§©Ê∞îÂ•ΩÔºåÊàë‰ª¨ÂéªÁà¨Â±±„ÄÇ',
                                options: ['Â¶ÇÊûú', 'Âõ†‰∏∫', 'ËôΩÁÑ∂', '‰ΩÜÊòØ'],
                                correct: 0,
                                explanation: 'Â¶ÇÊûú introduce una condizione: "Se il tempo √® bello..."'
                            }
                        ]
                    }
                }
            ]
        };

        // Initialize app
        updateProgressDisplay();
        showLessons(currentLevel);

        // Event listeners
        document.querySelectorAll('.level-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchLevel(tab.dataset.level);
            });
        });

        document.getElementById('back-btn').addEventListener('click', goBackToLessons);
        document.getElementById('close-exercise').addEventListener('click', closeExercise);
        document.getElementById('mark-complete').addEventListener('click', markLessonComplete);
        document.getElementById('prev-lesson').addEventListener('click', () => navigateLesson(-1));
        document.getElementById('next-lesson').addEventListener('click', () => navigateLesson(1));

        // Functions
        function switchLevel(level) {
            currentLevel = level;
            
            // Update tab appearance
            document.querySelectorAll('.level-tab').forEach(tab => {
                tab.classList.remove('bg-blue-500', 'text-white');
                tab.classList.add('text-gray-600');
            });
            
            document.querySelector(`[data-level="${level}"]`).classList.add('bg-blue-500', 'text-white');
            document.querySelector(`[data-level="${level}"]`).classList.remove('text-gray-600');
            
            showLessons(level);
        }

        function showLessons(level) {
            const lessons = grammarLessons[level];
            const grid = document.getElementById('lessons-grid');
            
            grid.innerHTML = lessons.map(lesson => {
                const isCompleted = completedLessons.has(lesson.id);
                const difficultyStars = '‚≠ê'.repeat(lesson.difficulty);
                
                return `
                    <div class="lesson-card bg-white rounded-xl p-6 shadow-sm border border-gray-100 cursor-pointer ${isCompleted ? 'ring-2 ring-green-300' : ''}" data-lesson="${lesson.id}">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900 mb-2">${lesson.title}</h3>
                                <p class="text-sm text-gray-600 mb-3">${lesson.description}</p>
                            </div>
                            ${isCompleted ? '<div class="text-green-500 text-xl">‚úì</div>' : ''}
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-500">‚è±Ô∏è ${lesson.duration}</span>
                            <span class="text-yellow-500" title="Difficolt√†">${difficultyStars}</span>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-100">
                            <div class="flex items-center justify-between">
                                <span class="text-xs text-gray-500 capitalize">${level}</span>
                                <span class="text-xs ${isCompleted ? 'text-green-600 font-medium' : 'text-blue-600'}">${isCompleted ? 'Completata' : 'Inizia ‚Üí'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click listeners
            grid.querySelectorAll('[data-lesson]').forEach(card => {
                card.addEventListener('click', () => {
                    showLesson(card.dataset.lesson);
                });
            });
        }

        function showLesson(lessonId) {
            currentLessonId = lessonId;
            const lesson = findLessonById(lessonId);
            
            if (!lesson) return;
            
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('lesson-content').classList.remove('hidden');
            
            // Update header
            const header = document.getElementById('lesson-header');
            header.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">${lesson.title}</h1>
                        <p class="text-lg text-gray-600 mb-4">${lesson.description}</p>
                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <span>‚è±Ô∏è ${lesson.duration}</span>
                            <span>‚≠ê ${'‚òÖ'.repeat(lesson.difficulty)}</span>
                            <span class="capitalize">${currentLevel}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        ${completedLessons.has(lessonId) ? 
                            '<div class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium">‚úì Completata</div>' : 
                            '<div class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-medium">In corso</div>'
                        }
                    </div>
                </div>
            `;
            
            // Update body
            const body = document.getElementById('lesson-body');
            body.innerHTML = `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <div class="prose max-w-none">
                        <div class="text-lg text-gray-700 mb-6 leading-relaxed">
                            ${lesson.content.introduction}
                        </div>
                        
                        ${lesson.content.sections.map(section => `
                            <div class="mb-8 slide-in">
                                <h3 class="text-xl font-semibold text-gray-900 mb-4">${section.title}</h3>
                                <p class="text-gray-700 mb-4">${section.content}</p>
                                
                                <div class="space-y-4">
                                    ${section.examples.map(example => `
                                        <div class="example-box rounded-lg p-4">
                                            <div class="chinese-text text-2xl font-bold text-gray-800 mb-2">${example.chinese}</div>
                                            <div class="pinyin-text text-lg mb-2">${example.pinyin}</div>
                                            <div class="text-gray-700 font-medium mb-3">${example.italian}</div>
                                            <div class="text-sm text-gray-600">
                                                ${example.breakdown.map(item => `<div class="mb-1">‚Ä¢ ${item}</div>`).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                        
                        ${lesson.content.notes && lesson.content.notes.length > 0 ? `
                            <div class="note-box rounded-lg p-4 mb-6">
                                <h4 class="font-semibold text-gray-900 mb-3">üìù Note Importanti</h4>
                                <ul class="space-y-2">
                                    ${lesson.content.notes.map(note => `<li class="text-sm text-gray-700">‚Ä¢ ${note}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        ${lesson.content.exercises && lesson.content.exercises.length > 0 ? `
                            <div class="exercise-box rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">‚úèÔ∏è Esercizi</h4>
                                <div class="space-y-4">
                                    ${lesson.content.exercises.map((exercise, index) => `
                                        <button class="exercise-btn w-full text-left p-4 bg-white rounded-lg border border-gray-200 hover:border-green-300 transition-colors" data-exercise="${index}">
                                            <div class="font-medium text-gray-900 mb-2">Esercizio ${index + 1}</div>
                                            <div class="text-sm text-gray-600">${exercise.question}</div>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Add exercise listeners
            body.querySelectorAll('.exercise-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const exerciseIndex = parseInt(btn.dataset.exercise);
                    showExercise(lesson.content.exercises[exerciseIndex]);
                });
            });
            
            updateLessonNavigation();
        }

        function showExercise(exercise) {
            currentExercise = exercise;
            const modal = document.getElementById('exercise-modal');
            const content = document.getElementById('exercise-content');
            
            let exerciseHTML = '';
            
            switch(exercise.type) {
                case 'choice':
                    exerciseHTML = `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">${exercise.question}</h4>
                            <div class="space-y-3">
                                ${exercise.options.map((option, index) => `
                                    <button class="exercise-option w-full text-left p-3 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors" data-index="${index}">
                                        ${option}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div id="exercise-result" class="hidden"></div>
                    `;
                    break;
                    
                case 'transform':
                case 'translate':
                    exerciseHTML = `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">${exercise.question}</h4>
                            <input type="text" id="exercise-input" class="w-full p-3 border border-gray-200 rounded-lg chinese-text text-lg" placeholder="Scrivi la tua risposta...">
                            <button id="check-answer" class="mt-4 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Controlla Risposta
                            </button>
                        </div>
                        <div id="exercise-result" class="hidden"></div>
                    `;
                    break;
                    
                case 'fill':
                case 'complete':
                    exerciseHTML = `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">${exercise.question}</h4>
                            <div class="space-y-3">
                                ${exercise.options.map((option, index) => `
                                    <button class="exercise-option w-full text-left p-3 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors chinese-text text-lg" data-index="${index}">
                                        ${option}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div id="exercise-result" class="hidden"></div>
                    `;
                    break;
                    
                case 'order':
                    exerciseHTML = `
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">${exercise.question}</h4>
                            <div class="flex flex-wrap gap-2 mb-4" id="word-bank">
                                ${exercise.words.map(word => `
                                    <button class="word-btn px-3 py-2 bg-gray-100 border border-gray-200 rounded-lg chinese-text text-lg hover:bg-blue-100 transition-colors">
                                        ${word}
                                    </button>
                                `).join('')}
                            </div>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-16 chinese-text text-lg" id="sentence-area">
                                <span class="text-gray-400">Trascina qui le parole nell'ordine corretto...</span>
                            </div>
                            <button id="check-order" class="mt-4 px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Controlla Ordine
                            </button>
                        </div>
                        <div id="exercise-result" class="hidden"></div>
                    `;
                    break;
            }
            
            content.innerHTML = exerciseHTML;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Add exercise-specific listeners
            setupExerciseListeners(exercise);
        }

        function setupExerciseListeners(exercise) {
            switch(exercise.type) {
                case 'choice':
                case 'fill':
                case 'complete':
                    document.querySelectorAll('.exercise-option').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const selectedIndex = parseInt(btn.dataset.index);
                            checkMultipleChoice(selectedIndex, exercise);
                        });
                    });
                    break;
                    
                case 'transform':
                case 'translate':
                    document.getElementById('check-answer').addEventListener('click', () => {
                        const userAnswer = document.getElementById('exercise-input').value.trim();
                        checkTextAnswer(userAnswer, exercise);
                    });
                    
                    document.getElementById('exercise-input').addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            document.getElementById('check-answer').click();
                        }
                    });
                    break;
                    
                case 'order':
                    setupWordOrderExercise(exercise);
                    break;
            }
        }

        function checkMultipleChoice(selectedIndex, exercise) {
            const result = document.getElementById('exercise-result');
            const options = document.querySelectorAll('.exercise-option');
            
            options.forEach(btn => btn.disabled = true);
            
            if (selectedIndex === exercise.correct) {
                options[selectedIndex].classList.add('bg-green-100', 'border-green-400');
                result.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="text-green-700 font-medium mb-2">‚úì Corretto!</div>
                        <div class="text-sm text-green-600">${exercise.explanation}</div>
                    </div>
                `;
            } else {
                options[selectedIndex].classList.add('bg-red-100', 'border-red-400');
                options[exercise.correct].classList.add('bg-green-100', 'border-green-400');
                result.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-700 font-medium mb-2">‚úó Non corretto</div>
                        <div class="text-sm text-red-600">${exercise.explanation}</div>
                    </div>
                `;
            }
            
            result.classList.remove('hidden');
        }

        function checkTextAnswer(userAnswer, exercise) {
            const result = document.getElementById('exercise-result');
            const isCorrect = userAnswer === exercise.correct;
            
            if (isCorrect) {
                result.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="text-green-700 font-medium mb-2">‚úì Corretto!</div>
                        <div class="text-sm text-green-600">${exercise.explanation}</div>
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="text-red-700 font-medium mb-2">‚úó Non corretto</div>
                        <div class="text-sm text-red-600 mb-2">Risposta corretta: <span class="chinese-text font-bold">${exercise.correct}</span></div>
                        <div class="text-sm text-red-600">${exercise.explanation}</div>
                    </div>
                `;
            }
            
            result.classList.remove('hidden');
        }

        function setupWordOrderExercise(exercise) {
            let selectedWords = [];
            
            document.querySelectorAll('.word-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const word = btn.textContent.trim();
                    selectedWords.push(word);
                    btn.disabled = true;
                    btn.classList.add('opacity-50');
                    
                    updateSentenceArea();
                });
            });
            
            document.getElementById('check-order').addEventListener('click', () => {
                const userSentence = selectedWords.join('');
                const isCorrect = userSentence === exercise.correct;
                
                const result = document.getElementById('exercise-result');
                if (isCorrect) {
                    result.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="text-green-700 font-medium mb-2">‚úì Corretto!</div>
                            <div class="text-sm text-green-600">Traduzione: ${exercise.translation}</div>
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <div class="text-red-700 font-medium mb-2">‚úó Non corretto</div>
                            <div class="text-sm text-red-600 mb-2">Ordine corretto: <span class="chinese-text font-bold">${exercise.correct}</span></div>
                            <div class="text-sm text-red-600">Traduzione: ${exercise.translation}</div>
                        </div>
                    `;
                }
                result.classList.remove('hidden');
            });
            
            function updateSentenceArea() {
                const area = document.getElementById('sentence-area');
                if (selectedWords.length > 0) {
                    area.innerHTML = selectedWords.join(' ');
                } else {
                    area.innerHTML = '<span class="text-gray-400">Trascina qui le parole nell\'ordine corretto...</span>';
                }
            }
        }

        function markLessonComplete() {
            if (currentLessonId) {
                completedLessons.add(currentLessonId);
                localStorage.setItem('completedLessons', JSON.stringify([...completedLessons]));
                updateProgressDisplay();
                
                // Update button
                const btn = document.getElementById('mark-complete');
                btn.innerHTML = '‚úì Completata';
                btn.classList.remove('bg-green-500', 'hover:bg-green-600');
                btn.classList.add('bg-gray-400');
                btn.disabled = true;
                
                // Show completion message
                const header = document.getElementById('lesson-header');
                const completionBadge = header.querySelector('.bg-blue-100');
                if (completionBadge) {
                    completionBadge.className = 'bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium';
                    completionBadge.innerHTML = '‚úì Completata';
                }
            }
        }

        function updateLessonNavigation() {
            const lessons = grammarLessons[currentLevel];
            const currentIndex = lessons.findIndex(lesson => lesson.id === currentLessonId);
            
            const prevBtn = document.getElementById('prev-lesson');
            const nextBtn = document.getElementById('next-lesson');
            const markBtn = document.getElementById('mark-complete');
            
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === lessons.length - 1;
            
            if (completedLessons.has(currentLessonId)) {
                markBtn.innerHTML = '‚úì Completata';
                markBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                markBtn.classList.add('bg-gray-400');
                markBtn.disabled = true;
            }
        }

        function navigateLesson(direction) {
            const lessons = grammarLessons[currentLevel];
            const currentIndex = lessons.findIndex(lesson => lesson.id === currentLessonId);
            const newIndex = currentIndex + direction;
            
            if (newIndex >= 0 && newIndex < lessons.length) {
                showLesson(lessons[newIndex].id);
            }
        }

        function findLessonById(id) {
            for (const level in grammarLessons) {
                const lesson = grammarLessons[level].find(l => l.id === id);
                if (lesson) return lesson;
            }
            return null;
        }

        function updateProgressDisplay() {
            const totalLessons = Object.values(grammarLessons).flat().length;
            const completed = completedLessons.size;
            const percentage = Math.round((completed / totalLessons) * 100);
            
            document.getElementById('completed-lessons').textContent = completed;
            document.getElementById('progress-percentage').textContent = percentage + '%';
        }

        function goBackToLessons() {
            document.getElementById('lesson-content').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
            currentLessonId = null;
        }

        function closeExercise() {
            document.getElementById('exercise-modal').classList.add('hidden');
            document.getElementById('exercise-modal').classList.remove('flex');
            currentExercise = null;
        }

        // Close modal when clicking outside
        document.getElementById('exercise-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeExercise();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9808e77fb4b9ed4e',t:'MTc1ODExNTI2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
<button class="inline-flex items-center justify-center rounded-md px-4 py-2 text-base text-white font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 bg-gradient-to-r from-red-500 to-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 active:transform active:scale-95"><a href="https://scottino2019-glitch.github.io/lingua-cinese/grammatica.html"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
</svg> Indietro </a></button>
</html>
