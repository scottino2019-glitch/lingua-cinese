<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creatore Lezioni di Cinese</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .chinese-text {
            font-family: 'SimSun', 'Microsoft YaHei', serif;
            font-size: 1.2em;
        }
        .pinyin-text {
            color: #6366f1;
            font-style: italic;
        }
        .lesson-card {
            transition: all 0.3s ease;
        }
        .lesson-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-full">
    <header class="gradient-bg text-white p-6 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold mb-2">üèÆ Creatore Lezioni di Cinese</h1>
            <p class="text-blue-100">Crea lezioni complete con grammatica, testi e vocabolario</p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-6">
        <!-- Controlli principali -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex gap-3">
                    <button onclick="createNewLesson()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        ‚ûï Nuova Lezione
                    </button>
                    <button onclick="exportAllLessons()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                        üì• Esporta Tutto in HTML
                    </button>
                </div>
                <div class="text-sm text-gray-600">
                    Lezioni create: <span id="lessonCount" class="font-bold text-blue-600">0</span>
                </div>
            </div>
        </div>

        <!-- Lista lezioni -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div id="lessonsList" class="space-y-4">
                <!-- Le lezioni appariranno qui -->
            </div>
        </div>

        <!-- Editor lezione -->
        <div id="lessonEditor" class="bg-white rounded-lg shadow-lg p-6 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Editor Lezione</h2>
                <button onclick="closeLessonEditor()" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
            </div>

            <!-- Informazioni base lezione -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="lessonTitle" class="block text-sm font-medium text-gray-700 mb-2">Titolo Lezione</label>
                        <input type="text" id="lessonTitle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Es: Lezione 1 - Saluti">
                    </div>
                    <div>
                        <label for="lessonLevel" class="block text-sm font-medium text-gray-700 mb-2">Livello</label>
                        <select id="lessonLevel" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="principiante">Principiante</option>
                            <option value="intermedio">Intermedio</option>
                            <option value="avanzato">Avanzato</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabs per sezioni -->
            <div class="mb-6">
                <div class="flex border-b border-gray-200">
                    <button onclick="switchTab('grammar')" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent" data-tab="grammar">
                        üìö Grammatica
                    </button>
                    <button onclick="switchTab('texts')" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent" data-tab="texts">
                        üìñ Testi
                    </button>
                    <button onclick="switchTab('vocabulary')" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent" data-tab="vocabulary">
                        üìù Vocabolario
                    </button>
                </div>
            </div>

            <!-- Sezione Grammatica -->
            <div id="grammarSection" class="tab-content">
                <div class="space-y-4">
                    <div>
                        <label for="grammarRule" class="block text-sm font-medium text-gray-700 mb-2">Regola Grammaticale</label>
                        <input type="text" id="grammarRule" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Es: Struttura delle frasi semplici">
                    </div>
                    <div>
                        <label for="grammarExplanation" class="block text-sm font-medium text-gray-700 mb-2">Spiegazione</label>
                        <textarea id="grammarExplanation" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Spiega la regola grammaticale..."></textarea>
                    </div>
                    <div>
                        <label for="grammarExample" class="block text-sm font-medium text-gray-700 mb-2">Esempio</label>
                        <input type="text" id="grammarExample" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Es: ÊàëÊòØÂ≠¶Áîü (w«í sh√¨ xu√©shƒìng) - Io sono uno studente">
                    </div>
                    <button onclick="addGrammarRule()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        Aggiungi Regola
                    </button>
                </div>
                <div id="grammarList" class="mt-6 space-y-3">
                    <!-- Regole grammaticali appariranno qui -->
                </div>
            </div>

            <!-- Sezione Testi -->
            <div id="textsSection" class="tab-content hidden">
                <div class="space-y-4">
                    <div>
                        <label for="textTitle" class="block text-sm font-medium text-gray-700 mb-2">Titolo Testo</label>
                        <input type="text" id="textTitle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Es: Dialogo al ristorante">
                    </div>
                    <div>
                        <label for="chineseText" class="block text-sm font-medium text-gray-700 mb-2">Testo Cinese</label>
                        <textarea id="chineseText" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent chinese-text" placeholder="Inserisci il testo in cinese..."></textarea>
                    </div>
                    <div>
                        <label for="pinyinText" class="block text-sm font-medium text-gray-700 mb-2">Pinyin</label>
                        <textarea id="pinyinText" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pinyin-text" placeholder="Inserisci la trascrizione pinyin..."></textarea>
                    </div>
                    <div>
                        <label for="translationText" class="block text-sm font-medium text-gray-700 mb-2">Traduzione Italiana</label>
                        <textarea id="translationText" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Inserisci la traduzione italiana..."></textarea>
                    </div>
                    <button onclick="addText()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        Aggiungi Testo
                    </button>
                </div>
                <div id="textsList" class="mt-6 space-y-4">
                    <!-- Testi appariranno qui -->
                </div>
            </div>

            <!-- Sezione Vocabolario -->
            <div id="vocabularySection" class="tab-content hidden">
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="chineseWord" class="block text-sm font-medium text-gray-700 mb-2">Parola Cinese</label>
                            <input type="text" id="chineseWord" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent chinese-text" placeholder="Ê±âÂ≠ó">
                        </div>
                        <div>
                            <label for="pinyinWord" class="block text-sm font-medium text-gray-700 mb-2">Pinyin</label>
                            <input type="text" id="pinyinWord" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pinyin-text" placeholder="h√†nz√¨">
                        </div>
                        <div>
                            <label for="italianWord" class="block text-sm font-medium text-gray-700 mb-2">Traduzione</label>
                            <input type="text" id="italianWord" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="carattere cinese">
                        </div>
                    </div>
                    <button onclick="addVocabulary()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        Aggiungi Parola
                    </button>
                </div>
                <div id="vocabularyList" class="mt-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3" id="vocabGrid">
                        <!-- Vocabolario apparir√† qui -->
                    </div>
                </div>
            </div>

            <!-- Pulsanti azioni lezione -->
            <div class="mt-8 flex gap-4 pt-6 border-t border-gray-200">
                <button onclick="saveLesson()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium">
                    üíæ Salva Lezione
                </button>
                <button onclick="exportCurrentLesson()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium">
                    üì§ Esporta questa Lezione
                </button>
                <button onclick="previewLesson()" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-lg font-medium">
                    üëÅÔ∏è Anteprima
                </button>
            </div>
        </div>
    </main>

    <script>
        let lessons = [];
        let currentLessonId = null;
        let currentLesson = {
            id: null,
            title: '',
            level: 'principiante',
            grammar: [],
            texts: [],
            vocabulary: []
        };

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', function() {
            loadLessons();
            updateLessonCount();
            switchTab('grammar');
        });

        // Gestione tabs
        function switchTab(tabName) {
            // Nascondi tutti i contenuti
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Rimuovi classe attiva da tutti i tab
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('tab-active', 'border-blue-500', 'text-blue-600');
                button.classList.add('text-gray-600');
            });
            
            // Mostra contenuto selezionato
            document.getElementById(tabName + 'Section').classList.remove('hidden');
            
            // Attiva tab selezionato
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            activeButton.classList.add('tab-active', 'border-blue-500', 'text-blue-600');
            activeButton.classList.remove('text-gray-600');
        }

        // Creazione nuova lezione
        function createNewLesson() {
            currentLessonId = Date.now();
            currentLesson = {
                id: currentLessonId,
                title: '',
                level: 'principiante',
                grammar: [],
                texts: [],
                vocabulary: []
            };
            
            // Reset form
            document.getElementById('lessonTitle').value = '';
            document.getElementById('lessonLevel').value = 'principiante';
            clearAllSections();
            
            document.getElementById('lessonEditor').classList.remove('hidden');
            switchTab('grammar');
        }

        // Chiudi editor
        function closeLessonEditor() {
            document.getElementById('lessonEditor').classList.add('hidden');
            currentLessonId = null;
        }

        // Aggiungi regola grammaticale
        function addGrammarRule() {
            const rule = document.getElementById('grammarRule').value.trim();
            const explanation = document.getElementById('grammarExplanation').value.trim();
            const example = document.getElementById('grammarExample').value.trim();
            
            if (!rule || !explanation || !example) {
                alert('Compila tutti i campi per la regola grammaticale');
                return;
            }
            
            const grammarItem = { rule, explanation, example };
            currentLesson.grammar.push(grammarItem);
            
            // Reset campi
            document.getElementById('grammarRule').value = '';
            document.getElementById('grammarExplanation').value = '';
            document.getElementById('grammarExample').value = '';
            
            renderGrammarList();
        }

        // Renderizza lista grammatica
        function renderGrammarList() {
            const container = document.getElementById('grammarList');
            container.innerHTML = '';
            
            currentLesson.grammar.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-blue-800 mb-2">${item.rule}</h4>
                            <p class="text-gray-700 mb-2">${item.explanation}</p>
                            <p class="chinese-text text-lg">${item.example}</p>
                        </div>
                        <button onclick="removeGrammarRule(${index})" class="text-red-500 hover:text-red-700 ml-4">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Rimuovi regola grammaticale
        function removeGrammarRule(index) {
            currentLesson.grammar.splice(index, 1);
            renderGrammarList();
        }

        // Aggiungi testo
        function addText() {
            const title = document.getElementById('textTitle').value.trim();
            const chinese = document.getElementById('chineseText').value.trim();
            const pinyin = document.getElementById('pinyinText').value.trim();
            const translation = document.getElementById('translationText').value.trim();
            
            if (!title || !chinese || !pinyin || !translation) {
                alert('Compila tutti i campi per il testo');
                return;
            }
            
            const textItem = { title, chinese, pinyin, translation };
            currentLesson.texts.push(textItem);
            
            // Reset campi
            document.getElementById('textTitle').value = '';
            document.getElementById('chineseText').value = '';
            document.getElementById('pinyinText').value = '';
            document.getElementById('translationText').value = '';
            
            renderTextsList();
        }

        // Renderizza lista testi
        function renderTextsList() {
            const container = document.getElementById('textsList');
            container.innerHTML = '';
            
            currentLesson.texts.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'bg-green-50 p-4 rounded-lg border-l-4 border-green-500';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-semibold text-green-800 mb-3">${item.title}</h4>
                            <div class="space-y-2">
                                <p class="chinese-text text-lg">${item.chinese}</p>
                                <p class="pinyin-text">${item.pinyin}</p>
                                <p class="text-gray-700 italic">${item.translation}</p>
                            </div>
                        </div>
                        <button onclick="removeText(${index})" class="text-red-500 hover:text-red-700 ml-4">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Rimuovi testo
        function removeText(index) {
            currentLesson.texts.splice(index, 1);
            renderTextsList();
        }

        // Aggiungi vocabolario
        function addVocabulary() {
            const chinese = document.getElementById('chineseWord').value.trim();
            const pinyin = document.getElementById('pinyinWord').value.trim();
            const italian = document.getElementById('italianWord').value.trim();
            
            if (!chinese || !pinyin || !italian) {
                alert('Compila tutti i campi per la parola');
                return;
            }
            
            const vocabItem = { chinese, pinyin, italian };
            currentLesson.vocabulary.push(vocabItem);
            
            // Reset campi
            document.getElementById('chineseWord').value = '';
            document.getElementById('pinyinWord').value = '';
            document.getElementById('italianWord').value = '';
            
            renderVocabularyList();
        }

        // Renderizza lista vocabolario
        function renderVocabularyList() {
            const container = document.getElementById('vocabGrid');
            container.innerHTML = '';
            
            currentLesson.vocabulary.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'bg-purple-50 p-3 rounded-lg border border-purple-200 hover:shadow-md transition-shadow';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="chinese-text text-lg font-semibold">${item.chinese}</p>
                            <p class="pinyin-text text-sm">${item.pinyin}</p>
                            <p class="text-gray-700 text-sm mt-1">${item.italian}</p>
                        </div>
                        <button onclick="removeVocabulary(${index})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Rimuovi vocabolario
        function removeVocabulary(index) {
            currentLesson.vocabulary.splice(index, 1);
            renderVocabularyList();
        }

        // Salva lezione
        function saveLesson() {
            const title = document.getElementById('lessonTitle').value.trim();
            const level = document.getElementById('lessonLevel').value;
            
            if (!title) {
                alert('Inserisci un titolo per la lezione');
                return;
            }
            
            currentLesson.title = title;
            currentLesson.level = level;
            
            // Trova se esiste gi√† o aggiungi nuova
            const existingIndex = lessons.findIndex(l => l.id === currentLesson.id);
            if (existingIndex >= 0) {
                lessons[existingIndex] = { ...currentLesson };
            } else {
                lessons.push({ ...currentLesson });
            }
            
            saveLessons();
            renderLessonsList();
            updateLessonCount();
            
            alert('Lezione salvata con successo!');
        }

        // Carica lezione per modifica
        function editLesson(lessonId) {
            const lesson = lessons.find(l => l.id === lessonId);
            if (!lesson) return;
            
            currentLessonId = lessonId;
            currentLesson = { ...lesson };
            
            // Popola form
            document.getElementById('lessonTitle').value = lesson.title;
            document.getElementById('lessonLevel').value = lesson.level;
            
            // Renderizza contenuti
            renderGrammarList();
            renderTextsList();
            renderVocabularyList();
            
            document.getElementById('lessonEditor').classList.remove('hidden');
            switchTab('grammar');
        }

        // Elimina lezione
        function deleteLesson(lessonId) {
            if (confirm('Sei sicuro di voler eliminare questa lezione?')) {
                lessons = lessons.filter(l => l.id !== lessonId);
                saveLessons();
                renderLessonsList();
                updateLessonCount();
            }
        }

        // Renderizza lista lezioni
        function renderLessonsList() {
            const container = document.getElementById('lessonsList');
            container.innerHTML = '';
            
            if (lessons.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <div class="text-6xl mb-4">üìö</div>
                        <p class="text-lg">Nessuna lezione creata ancora</p>
                        <p class="text-sm">Clicca "Nuova Lezione" per iniziare</p>
                    </div>
                `;
                return;
            }
            
            lessons.forEach(lesson => {
                const div = document.createElement('div');
                div.className = 'lesson-card bg-white p-6 rounded-lg shadow-md border border-gray-200';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${lesson.title}</h3>
                            <span class="inline-block px-3 py-1 text-sm font-medium rounded-full ${getLevelColor(lesson.level)}">${lesson.level}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editLesson(${lesson.id})" class="text-blue-600 hover:text-blue-800 p-2">‚úèÔ∏è</button>
                            <button onclick="deleteLesson(${lesson.id})" class="text-red-600 hover:text-red-800 p-2">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-sm text-gray-600">
                        <div class="text-center">
                            <div class="font-semibold text-blue-600">${lesson.grammar.length}</div>
                            <div>Regole</div>
                        </div>
                        <div class="text-center">
                            <div class="font-semibold text-green-600">${lesson.texts.length}</div>
                            <div>Testi</div>
                        </div>
                        <div class="text-center">
                            <div class="font-semibold text-purple-600">${lesson.vocabulary.length}</div>
                            <div>Parole</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Colore livello
        function getLevelColor(level) {
            switch(level) {
                case 'principiante': return 'bg-green-100 text-green-800';
                case 'intermedio': return 'bg-yellow-100 text-yellow-800';
                case 'avanzato': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Pulisci sezioni
        function clearAllSections() {
            document.getElementById('grammarList').innerHTML = '';
            document.getElementById('textsList').innerHTML = '';
            document.getElementById('vocabGrid').innerHTML = '';
        }

        // Aggiorna contatore
        function updateLessonCount() {
            document.getElementById('lessonCount').textContent = lessons.length;
        }

        // Salva nel localStorage
        function saveLessons() {
            localStorage.setItem('chineseLessons', JSON.stringify(lessons));
        }

        // Carica dal localStorage
        function loadLessons() {
            const saved = localStorage.getItem('chineseLessons');
            if (saved) {
                lessons = JSON.parse(saved);
                renderLessonsList();
            }
        }

        // Esporta lezione corrente
        function exportCurrentLesson() {
            if (!currentLesson.title) {
                alert('Salva prima la lezione');
                return;
            }
            
            // Aggiorna i dati della lezione corrente con i valori del form
            currentLesson.title = document.getElementById('lessonTitle').value.trim();
            currentLesson.level = document.getElementById('lessonLevel').value;
            
            exportLesson(currentLesson);
        }

        // Esporta tutte le lezioni
        function exportAllLessons() {
            if (lessons.length === 0) {
                alert('Nessuna lezione da esportare');
                return;
            }
            
            const allLessonsHtml = generateAllLessonsHtml();
            downloadHtml(allLessonsHtml, 'tutte-le-lezioni-cinese.html');
        }

        // Esporta singola lezione
        function exportLesson(lesson) {
            const html = generateLessonHtml(lesson);
            downloadHtml(html, `lezione-${lesson.title.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.html`);
        }

        // Genera HTML per singola lezione
        function generateLessonHtml(lesson) {
            return `<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${lesson.title}</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 40px 20px; 
            line-height: 1.7; 
            background: #fafafa;
            color: #333;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .chinese { 
            font-family: 'Microsoft YaHei', 'SimSun', serif; 
            font-size: 1.4em; 
            font-weight: 500;
            color: #2c3e50;
        }
        .pinyin { 
            color: #8b5cf6; 
            font-style: italic; 
            font-size: 1.1em;
            margin: 8px 0;
        }
        .section { 
            margin: 40px 0; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .grammar { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            border-left: 6px solid #2196f3; 
        }
        .text { 
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%); 
            border-left: 6px solid #4caf50; 
        }
        .vocab { 
            background: linear-gradient(135deg, #faf5ff 0%, #fff0f5 100%); 
            border-left: 6px solid #9c27b0; 
        }
        .vocab-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-top: 20px;
        }
        .vocab-item { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease;
        }
        .vocab-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
        }
        h1 { 
            color: #1a237e; 
            border-bottom: 4px solid #3f51b5; 
            padding-bottom: 15px; 
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }
        h2 { 
            color: #424242; 
            margin: 30px 0 20px 0; 
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h3 { 
            color: #555; 
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }
        h4 {
            color: #666;
            margin: 15px 0 8px 0;
            font-size: 1.1em;
        }
        .level { 
            display: inline-block; 
            padding: 8px 20px; 
            border-radius: 25px; 
            font-size: 0.9em; 
            font-weight: bold; 
            margin: 20px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .level-principiante { 
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7); 
            color: #1b5e20; 
        }
        .level-intermedio { 
            background: linear-gradient(135deg, #fff3e0, #ffcc02); 
            color: #e65100; 
        }
        .level-avanzato { 
            background: linear-gradient(135deg, #ffebee, #ef5350); 
            color: #b71c1c; 
        }
        .grammar-item, .text-item {
            background: rgba(255,255,255,0.7);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #666;
        }
        .grammar-item {
            border-left-color: #2196f3;
        }
        .text-item {
            border-left-color: #4caf50;
        }
        .translation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-style: italic;
            color: #495057;
            margin-top: 10px;
        }
        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 2em; }
            .vocab-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>${lesson.title}</h1>
            <div style="text-align: center;">
                <span class="level level-${lesson.level}">${lesson.level}</span>
            </div>
        </header>

        ${lesson.grammar.length > 0 ? `
        <section class="section grammar">
            <h2>üìö Grammatica</h2>
            ${lesson.grammar.map(item => `
                <div class="grammar-item">
                    <h3>${item.rule}</h3>
                    <p style="margin: 15px 0; font-size: 1.1em; line-height: 1.6;">${item.explanation}</p>
                    <div style="margin-top: 15px;">
                        <strong>Esempio:</strong>
                        <p class="chinese" style="margin: 10px 0;">${item.example}</p>
                    </div>
                </div>
            `).join('')}
        </section>
        ` : ''}

        ${lesson.texts.length > 0 ? `
        <section class="section text">
            <h2>üìñ Testi e Dialoghi</h2>
            ${lesson.texts.map(item => `
                <div class="text-item">
                    <h3>${item.title}</h3>
                    <div style="margin: 20px 0;">
                        <div style="margin-bottom: 15px;">
                            <strong>Testo cinese:</strong>
                            <p class="chinese" style="margin: 10px 0; font-size: 1.5em; line-height: 1.8;">${item.chinese}</p>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Pinyin:</strong>
                            <p class="pinyin" style="margin: 10px 0; font-size: 1.2em;">${item.pinyin}</p>
                        </div>
                        <div>
                            <strong>Traduzione italiana:</strong>
                            <div class="translation">${item.translation}</div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </section>
        ` : ''}

        ${lesson.vocabulary.length > 0 ? `
        <section class="section vocab">
            <h2>üìù Vocabolario</h2>
            <div class="vocab-grid">
                ${lesson.vocabulary.map(item => `
                    <div class="vocab-item">
                        <div class="chinese" style="font-size: 1.6em; font-weight: bold; margin-bottom: 8px;">${item.chinese}</div>
                        <div class="pinyin" style="margin-bottom: 8px; font-size: 1.1em;">${item.pinyin}</div>
                        <div style="color: #666; font-size: 1.1em; font-weight: 500;">${item.italian}</div>
                    </div>
                `).join('')}
            </div>
        </section>
        ` : ''}

        <footer style="margin-top: 60px; padding-top: 30px; border-top: 2px solid #e0e0e0; text-align: center; color: #888;">
            <p style="font-size: 0.9em;">üìö Lezione di cinese ‚Ä¢ Creata per lo studio autonomo</p>
        </footer>
    </div>
</body>
</html>`;
        }

        // Genera HTML per tutte le lezioni
        function generateAllLessonsHtml() {
            return `<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raccolta Completa - Lezioni di Cinese</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.7; 
            background: #f8fafc;
            color: #2d3748;
        }
        .main-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }
        .content {
            padding: 40px;
        }
        .chinese { 
            font-family: 'Microsoft YaHei', 'SimSun', serif; 
            font-size: 1.4em; 
            font-weight: 500;
            color: #2c3e50;
        }
        .pinyin { 
            color: #8b5cf6; 
            font-style: italic; 
            font-size: 1.1em;
            margin: 8px 0;
        }
        .lesson { 
            margin: 50px 0; 
            padding: 40px; 
            border: 1px solid #e2e8f0; 
            border-radius: 16px; 
            background: #fafbfc;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        .lesson:first-child {
            margin-top: 30px;
        }
        .section { 
            margin: 35px 0; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        .grammar { 
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); 
            border-left: 6px solid #2196f3; 
        }
        .text { 
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%); 
            border-left: 6px solid #4caf50; 
        }
        .vocab { 
            background: linear-gradient(135deg, #faf5ff 0%, #fff0f5 100%); 
            border-left: 6px solid #9c27b0; 
        }
        .vocab-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-top: 25px;
        }
        .vocab-item { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .vocab-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        h1 { 
            font-size: 3em; 
            margin: 0 0 20px 0;
            font-weight: 700;
        }
        h2 { 
            color: #2d3748; 
            border-bottom: 3px solid #4299e1; 
            padding-bottom: 12px; 
            margin: 30px 0 25px 0;
            font-size: 2.2em;
            font-weight: 600;
        }
        h3 { 
            color: #4a5568; 
            margin: 25px 0 15px 0;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        h4 {
            color: #718096;
            margin: 20px 0 10px 0;
            font-size: 1.3em;
        }
        h5 {
            color: #a0aec0;
            margin: 15px 0 8px 0;
            font-size: 1.1em;
        }
        .level { 
            display: inline-block; 
            padding: 10px 25px; 
            border-radius: 30px; 
            font-size: 0.9em; 
            font-weight: bold; 
            margin: 0 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .level-principiante { 
            background: linear-gradient(135deg, #48bb78, #38a169); 
            color: white; 
        }
        .level-intermedio { 
            background: linear-gradient(135deg, #ed8936, #dd6b20); 
            color: white; 
        }
        .level-avanzato { 
            background: linear-gradient(135deg, #f56565, #e53e3e); 
            color: white; 
        }
        .toc { 
            background: linear-gradient(135deg, #edf2f7, #e2e8f0); 
            padding: 40px; 
            border-radius: 16px; 
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .toc h2 {
            color: #2d3748;
            border-bottom: 3px solid #4299e1;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .toc ul { 
            list-style: none; 
            padding: 0; 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .toc li { 
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .toc li:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .toc a { 
            text-decoration: none; 
            color: #4299e1; 
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .toc a:hover { 
            color: #2b6cb0;
        }
        .grammar-item, .text-item {
            background: rgba(255,255,255,0.8);
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border-left: 5px solid #666;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .grammar-item {
            border-left-color: #2196f3;
        }
        .text-item {
            border-left-color: #4caf50;
        }
        .translation {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            font-style: italic;
            color: #4a5568;
            margin-top: 15px;
            border-left: 4px solid #cbd5e0;
        }
        .stats {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        .stat-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        @media (max-width: 768px) {
            .content { padding: 20px; }
            .lesson { padding: 20px; }
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.8em; }
            .toc ul { grid-template-columns: 1fr; }
            .vocab-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="header">
            <h1>üèÆ Raccolta Completa</h1>
            <h2 style="border: none; margin: 0; font-size: 1.5em; font-weight: 400;">Lezioni di Cinese per lo Studio Autonomo</h2>
            <div class="stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number">${lessons.length}</span>
                        <span>Lezioni</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${lessons.reduce((acc, l) => acc + l.grammar.length, 0)}</span>
                        <span>Regole</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${lessons.reduce((acc, l) => acc + l.texts.length, 0)}</span>
                        <span>Testi</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${lessons.reduce((acc, l) => acc + l.vocabulary.length, 0)}</span>
                        <span>Parole</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="content">
            <nav class="toc">
                <h2>üìã Indice delle Lezioni</h2>
                <ul>
                    ${lessons.map((lesson, index) => `
                        <li>
                            <a href="#lesson-${lesson.id}">
                                <span>${index + 1}. ${lesson.title}</span>
                                <span class="level level-${lesson.level}">${lesson.level}</span>
                            </a>
                        </li>
                    `).join('')}
                </ul>
            </nav>

            ${lessons.map((lesson, index) => `
                <article class="lesson" id="lesson-${lesson.id}">
                    <header>
                        <h2>${index + 1}. ${lesson.title} <span class="level level-${lesson.level}">${lesson.level}</span></h2>
                    </header>

                    ${lesson.grammar.length > 0 ? `
                    <section class="section grammar">
                        <h3>üìö Grammatica</h3>
                        ${lesson.grammar.map(item => `
                            <div class="grammar-item">
                                <h4>${item.rule}</h4>
                                <p style="margin: 15px 0; font-size: 1.1em; line-height: 1.7;">${item.explanation}</p>
                                <div style="margin-top: 15px;">
                                    <strong>Esempio:</strong>
                                    <p class="chinese" style="margin: 10px 0; font-size: 1.4em;">${item.example}</p>
                                </div>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}

                    ${lesson.texts.length > 0 ? `
                    <section class="section text">
                        <h3>üìñ Testi e Dialoghi</h3>
                        ${lesson.texts.map(item => `
                            <div class="text-item">
                                <h4>${item.title}</h4>
                                <div style="margin: 20px 0;">
                                    <div style="margin-bottom: 20px;">
                                        <h5>Testo cinese:</h5>
                                        <p class="chinese" style="margin: 10px 0; font-size: 1.5em; line-height: 1.8;">${item.chinese}</p>
                                    </div>
                                    <div style="margin-bottom: 20px;">
                                        <h5>Pinyin:</h5>
                                        <p class="pinyin" style="margin: 10px 0; font-size: 1.2em;">${item.pinyin}</p>
                                    </div>
                                    <div>
                                        <h5>Traduzione italiana:</h5>
                                        <div class="translation">${item.translation}</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </section>
                    ` : ''}

                    ${lesson.vocabulary.length > 0 ? `
                    <section class="section vocab">
                        <h3>üìù Vocabolario</h3>
                        <div class="vocab-grid">
                            ${lesson.vocabulary.map(item => `
                                <div class="vocab-item">
                                    <div class="chinese" style="font-size: 1.8em; font-weight: bold; margin-bottom: 10px;">${item.chinese}</div>
                                    <div class="pinyin" style="margin-bottom: 10px; font-size: 1.2em;">${item.pinyin}</div>
                                    <div style="color: #4a5568; font-size: 1.1em; font-weight: 500;">${item.italian}</div>
                                </div>
                            `).join('')}
                        </div>
                    </section>
                    ` : ''}
                </article>
            `).join('')}

            <footer style="margin-top: 80px; padding: 40px; background: linear-gradient(135deg, #edf2f7, #e2e8f0); border-radius: 16px; text-align: center; color: #4a5568;">
                <h3 style="color: #2d3748; margin-bottom: 20px;">üìö Raccolta Completa di Lezioni di Cinese</h3>
                <p style="font-size: 1.1em; margin-bottom: 10px;">
                    <strong>Totale contenuti:</strong> ${lessons.length} lezioni complete
                </p>
                <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px;">
                    <span>üìñ ${lessons.reduce((acc, l) => acc + l.grammar.length, 0)} regole grammaticali</span>
                    <span>üìù ${lessons.reduce((acc, l) => acc + l.texts.length, 0)} testi con pinyin</span>
                    <span>üî§ ${lessons.reduce((acc, l) => acc + l.vocabulary.length, 0)} parole del vocabolario</span>
                </div>
                <p style="margin-top: 30px; font-size: 0.9em; color: #718096;">
                    Creato per lo studio autonomo della lingua cinese
                </p>
            </footer>
        </div>
    </div>
</body>
</html>`;
        }

        // Download HTML
        function downloadHtml(content, filename) {
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Anteprima lezione
        function previewLesson() {
            const title = document.getElementById('lessonTitle').value.trim();
            if (!title) {
                alert('Inserisci almeno un titolo per vedere l\'anteprima');
                return;
            }
            
            // Aggiorna i dati della lezione corrente con i valori del form
            currentLesson.title = title;
            currentLesson.level = document.getElementById('lessonLevel').value;
            
            const html = generateLessonHtml(currentLesson);
            const newWindow = window.open('', '_blank');
            newWindow.document.write(html);
            newWindow.document.close();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9906de8d4733ee54',t:'MTc2MDc3ODI3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
